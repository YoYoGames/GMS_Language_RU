
  
  Push-уведомления
  Событие Push-уведомления - это событие, которое запускается обратным вызовом из push-уведомления    на ОС устройства, либо из локального источника с помощью функции push_local_notification(), либо
    из удаленного источника (т.е. с вашего сервера). Оно генерирует DS Map, которая является эксклюзивной для этого события и хранится в специальной переменной  async_load     (примеры кода, поясняющие использование этого события, смотрите в отдельных функциях, вызывающих асинхронные события). Эта DS-карта имеет следующие ключи:
  
    "type": Значение может быть "local" для локального уведомления устройства, "remote" для удаленного уведомления или "register" для регистрации удаленного уведомления.
    "status": Значение будет равно "1" для успеха или "0" для ошибки.
  
  В зависимости от возвращаемого "типа" и значения "статуса" могут быть дополнительные ключевые записи. Для "статуса", если была возвращена ошибка ("0"), то у вас также будет следующий ключ:
  
    "error": Содержит подробную информацию о полученной ошибке.
  
  Если значение "status" равно 1 (т.е. ошибок нет), то карта DS будет содержать следующие дополнительные значения, в зависимости от значения ключа "type":
  
    "reg_id": Если полученный "тип" был "register", то этот ключ будет содержать идентификатор регистрации устройства для удаленных уведомлений.
    "data": Если полученный "тип" был "локальный" или "удаленный", то этот ключ будет содержать строку полезной нагрузки, которую вы определили при вызове функции уведомления.
  
  Чтобы лучше понять это, мы создали для вас небольшой пример фрагмента ниже. В этом примере мы отправим локальное push-уведомление, используя следующий код:
  var fireTime = date_inc_day(date_current_datetime(), 1); var data = "daily_reward"; push_local_notification(fireTime, "Ahoy!", "Catch The Haggis Has A Present", data);
  Это позволит установить таймер, который будет "выталкивать" уведомление на устройство по истечении одного дня. По истечении дня, если ваша игра находится в фоновом режиме или не запущена, пользователю будет показано уведомление с заданным названием и сообщением (на
   iOS показывается название игры, а заголовок игнорируется), а затем будет вызвано асинхронное событие Push Notification Event. Обратите внимание, что если игра находится на переднем плане, когда наступит время для уведомления, она не будет показана, но асинхронное событие все равно сработает.
    В самом событии вы должны обработать обратный вызов следующим образом:
  var type = ds_map_find_value(async_load, "type"); var status = ds_map_find_value(async_load, "status");  if status == 0 { //ошибка какого-то типа var error = ds_map_find_value(async_load, "error"); show_debug_message("error=" + string(error)); }  else
     { if type == "register" { global.reg_id = ds_map_find_value(async_load, "reg_id"); }  else { var data = ds_map_find_value(async_load, "data"); if data == "daily_reward" { global.Gold += 1000; }  }  }
   
   
   
  
    
      
        Назад: Асинхронные события
        Следующий: Сохранить / Загрузить
      
    
    © Copyright YoYo Games Ltd. 2021 Все права защищены
  
  
  

